共识是一种就共享状态达成一致的方法。 为了使区块链的状态能够继续建立和向前发展，网络中的所有节点都必须同意并达成共识。这是去中心化网络中的节点能够彼此保持同步的方式。如果区块链中节点的去中心化网络没有达成共识，就无法确保一个节点认为是真实的状态将被其他节点共享。共识的目的是在每个对网络都有自己主观看法的参与者中提供对状态的客观看法。这是这些节点进行通信并达成协议并能够构建新块的过程。

# 验证者选举：信誉轮值共识

CESS 使用随机选取轮值共识（R²S）作为其选择验证者集的机制。对维护网络感兴趣的参与者可以运行验证节点。验证者承担生产新区块、验证区块和保证最终性的角色。

点击 [**信誉轮值共识**](../../ref/rrc.md) 查看更多详细信息。

# 区块生成机制：BABE

BABE (**B**lind **A**ssignment for **B**lockchain **E**xtension) 是在验证节点之间运行并确定新区块作者的区块生产机制。链运行时需要通过每个 epoch 的第一个块的标头中的共识消息向主机提供 BABE 权限列表和随机性。

BABE 的执行发生在称为 epoch 的连续非重叠阶段。每个纪元被划分为预定义数量的 slot。每个时期中的所有 slot 都从 0（slot编号）开始按顺序索引。 在每个 epoch 开始时，需要运行 Block-Production-Lottery 算法来找出它应该在哪个 slot 中生产一个块并与其他块生产者进行广播。

验证者参与每个 slot 的抽签，这将告知他们是否是该 slot 的区块生产者候选人。 slot 是离散的时间单位，长度约为 6 秒。由于为验证器分配 slot 的机制是基于随机设计的，因此多个验证器可能是同一个 slot 的候选者。 其他时候，一个槽可能是空的，导致块时间不一致。

## Slot 有多个候选者

当多个验证者在某一 slot 中都是区块生产者候选者时，他们都将产生一个区块并将其广播到网络。在这一点上，这是一场比赛。 块到达大部分网络的验证者首先获胜。根据网络拓扑和延迟，两条链将继续构建一些容量，直到最终确定开始并截断分叉。

## Slot 没有候选者

当没有验证者在随机抽签中滚动到足够低的水平以符合块生产的资格时，一个 slot 可以保持看似无块。我们通过在后台运行辅助的、循环式验证者选择算法来避免这种情况。通过此算法选择生成块的验证者始终生成块，但如果同一 slot 也从 VRF 选择的验证者生成主块，则这些次要块将被忽略。因此，一个 slot 可以有一个主块或一个辅助块，并且不会跳过任何槽。

# 区块最终确定机制：GRANDPA

GRANDPA (**G**HOST-based **R**ecursive **AN**cestor **D**eriving **P**refix **A**greement) 是为 CESS 的最终确定工具。

最终确定性是通过验证者的连续轮次投票获得的。验证者以一项独立服务执行 GRANDPA 最终确定过程，与区块生产并行执行。

只要 2/3 的节点是诚实的，它就可以在部分同步的网络模型中工作，并且可以在异步设置中处理 1/5 的拜占庭节点。

一个显着的区别是 GRANDPA 在链上而不是块上达成协议，大大加快了最终确定过程，即使在长期网络分区或其他网络故障之后也是如此。换句话说，一旦超过 2/3 的验证者证明包含某个区块的链，所有指向该区块的区块都会立即完成。
